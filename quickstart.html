
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Quickstart Guide &#8212; vmt-plan 1.0.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="vmtplanner — Developer Interfaces" href="vmtplanner.html" />
    <link rel="prev" title="Installation" href="install.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="quickstart-guide">
<h1>Quickstart Guide<a class="headerlink" href="#quickstart-guide" title="Permalink to this headline">¶</a></h1>
<p>vmt-plan utilizes <a class="reference external" href="https://github.com/rastern/vmt-connect/">vmt-connect</a> for base communication with the Turbonomic <a class="reference external" href="https://cdn.turbonomic.com/wp-content/uploads/docs/VMT_REST2_API_PRINT.pdf">API</a>,
while providing additional planning capabilities.</p>
<div class="section" id="getting-connected">
<h2>Getting Connected<a class="headerlink" href="#getting-connected" title="Permalink to this headline">¶</a></h2>
<p>Using the <a class="reference external" href="https://rastern.github.io/vmt-connect/vmtconnect.html#vmtconnect.VMTConnection" title="(in vmt-connect v1.0.0)"><code class="xref py py-class docutils literal"><span class="pre">VMTConnection</span></code></a> class to connect to Turbonomic.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vmtconnect</span> <span class="k">as</span> <span class="nn">vc</span>
<span class="kn">import</span> <span class="nn">vmtplanner</span> <span class="k">as</span> <span class="nn">vp</span>

<span class="n">vmt</span> <span class="o">=</span> <span class="n">vc</span><span class="o">.</span><span class="n">VMTConnection</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s1">&#39;bob&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;*****&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With this we have a connection setup and ready to use. Now we can create a plan
scenario. Here will will do a simple projection plan using two groups of VMs.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># scoping to two groups by UUID</span>
<span class="n">scope</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;430e28cbaabf35522a180859d4160562d123ac78&#39;</span><span class="p">,</span>
         <span class="s1">&#39;e48fd3270917221d3e6290e1affead34b872e95b&#39;</span><span class="p">]</span>
<span class="n">scenario</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">PlanSpec</span><span class="p">(</span><span class="s1">&#39;custom scenario&#39;</span><span class="p">,</span> <span class="n">vp</span><span class="o">.</span><span class="n">PlanType</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">,</span> <span class="n">scope</span><span class="p">)</span>

<span class="c1"># add 5 copies of a VM immediately</span>
<span class="n">scenario</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="s1">&#39;1341c28a-c9b7-46a5-ab25-321260482a91&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># add 1 copy each month for 2 months</span>
<span class="n">scenario</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="s1">&#39;1341c28a-c9b7-46a5-ab25-321260482a91&#39;</span><span class="p">,</span> <span class="n">count</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">])</span>
</pre></div>
</div>
<p>With the scenario created, and VMs added, we can initialize the market and run
the plan using our connection in the first example.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="n">plan</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">Plan</span><span class="p">(</span><span class="n">vmt</span><span class="p">,</span> <span class="n">scenario</span><span class="p">)</span>
<span class="n">plan</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>When the plan is finished, we can retrieve the stats for the market plan we ran.
Plan results will be listed for each period the plan ran, with a minimum of one
period.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">plan</span><span class="o">.</span><span class="n">is_complete</span><span class="p">():</span>
    <span class="n">plan</span><span class="o">.</span><span class="n">get_stats</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="complex-plans">
<h2>Complex Plans<a class="headerlink" href="#complex-plans" title="Permalink to this headline">¶</a></h2>
<p>The plan engine is capable of complex multi-stage plans. For instance, you may
want to see what happens when you let Turbonomic fully control your environment
before making new VM placements, and compare it against simply adding the VMs
in the current environment. Multi-staged plans are also called plan-on-plan
projections because we are running a plan on top of the results of a previous
plan.</p>
<p>Let’s say we want to simulate merging two clusters before adding workload. First
we need to deal with the clusters and let Turbonomic sort out the environment.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># scoping to two clusters by UUID</span>
<span class="n">scope</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;430e28cbaabf35522a180859d4160562d123ac78&#39;</span><span class="p">,</span>
         <span class="s1">&#39;e48fd3270917221d3e6290e1affead34b872e95b&#39;</span><span class="p">]</span>

<span class="n">cluster_merge</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">PlanSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;custom scenario&#39;</span><span class="p">,</span>
                            <span class="nb">type</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">PlanType</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">,</span>
                            <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span>
                            <span class="n">host_suspension</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">datastore_removal</span><span class="o">=</span><span class="kc">True</span>
                            <span class="n">resize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">stage1</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">Plan</span><span class="p">(</span><span class="n">vmt</span><span class="p">,</span> <span class="n">cluster_merge</span><span class="p">)</span>
<span class="n">stage1</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>After the plan finishes, we can utilize the first stage market as the input to
the next stage, into which we will add our new workload.</p>
<div class="code python highlight-default"><div class="highlight"><pre><span></span><span class="c1"># new scenario called add_workload</span>
<span class="n">add_workload</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">PlanSpec</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;custom scenario&#39;</span><span class="p">,</span>
                           <span class="nb">type</span><span class="o">=</span><span class="n">vp</span><span class="o">.</span><span class="n">PlanType</span><span class="o">.</span><span class="n">CUSTOM</span><span class="p">)</span>

<span class="c1"># add 10 copies of a VM immediately</span>
<span class="n">add_workload</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="s1">&#39;1341c28a-c9b7-46a5-ab25-321260482a91&#39;</span><span class="p">,</span>
                        <span class="n">count</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="n">stage2</span> <span class="o">=</span> <span class="n">vp</span><span class="o">.</span><span class="n">Plan</span><span class="p">(</span><span class="n">vmt</span><span class="p">,</span> <span class="n">add_workload</span><span class="p">,</span>
                 <span class="n">market</span><span class="o">=</span><span class="n">stage1</span><span class="o">.</span><span class="n">market_id</span><span class="p">)</span>
<span class="n">stage2</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>In this case we did not need to re-scope the second plan because the results
market from stage1 already contains only the clusters we want, and we want
everything in the results market. You’ll note when creating the <code class="xref py py-class docutils literal"><span class="pre">Plan</span></code>
we specify we are using a market other than the default one by passing in the
market uuid from <cite>stage1</cite>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Quickstart Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-connected">Getting Connected</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complex-plans">Complex Plans</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="vmtplanner.html"><code class="docutils literal"><span class="pre">vmtplanner</span></code> — Developer Interfaces</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="install.html" title="previous chapter">Installation</a></li>
      <li>Next: <a href="vmtplanner.html" title="next chapter"><code class="docutils literal"><span class="pre">vmtplanner</span></code> — Developer Interfaces</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, R.A. Stern.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="_sources/quickstart.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>